<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Anniversary, My Love ‚Äî Interaktif</title>

  <!-- Fonts & Swiper -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/swiper@9/swiper-bundle.min.css" />

  <style>
    :root{
      /* Tema & warna kucing */
      --fur:#E99A2A;          /* bulu utama */
      --fur-dark:#D07F15;     /* bayangan bulu */
      --muzzle:#F7E6CE;       /* moncong & kaki putih krem */
      --nose:#EC6D6D;
      --eye:#2b1b22;

      --pink:#e8a6bd;      
      --pink-dark:#d07d9b; 
      --rose:#f3b3c7;      
      --blush:#fde6ee;     
      --cream:#fff8fb;     
      --ink:#3a2430;       
      --gold:#e7c58d;      
      --green:#2ecc71;     
      --red:#e74c3c;       
      --sat:0.95;          
      --bri:1.0;           
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; 
      scroll-behavior: auto !important;
      background:linear-gradient(160deg, #ffe2ea, #ffc2d5 60%, #ff9fc0);
      color:var(--ink); overflow-x:hidden; 
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; scroll-behavior:smooth;
      filter: saturate(var(--sat)) brightness(var(--bri));
    }

    /* ---------- HERO / OPENING ---------- */
    .hero{position:relative; min-height:100svh; display:grid; place-items:center; background:radial-gradient(1200px 800px at 50% 15%, #213154, #0f2444 70%, #0c1b33);}
    .hero::before{content:""; position:absolute; inset:0; background:radial-gradient(1200px 800px at 50% 10%, #2a3c63 0%, transparent 60%); opacity:.45; pointer-events:none}
    .hero-inner{position:relative; z-index:2; display:grid; justify-items:center; gap:1.25rem; padding:28px 16px}

    .headline{color:#f2f5ff; text-align:center; max-width:900px}
    .headline .title{font-family:'Cormorant Garamond', serif; font-weight:700; font-size:clamp(2.2rem, 5.2vw, 4.2rem); line-height:1.08; letter-spacing:.3px}
    .headline .tag{font-size:clamp(.60rem, 2.4vw, 1.15rem); opacity:.9}
    .typewriter{ font-size: 6vw; font-family: 'Poppins', sans-serif; border-right:2px solid rgba(255,255,255,.65); white-space:nowrap; overflow:hidden}
    .cntr {
  height: 400px;
  width: 400px;
  position: relative;
}

.cntr .stand {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%);
  height: 20px;
  width: 200px;
  border-radius: 20px;
  background-color: #fd6e72;
  z-index: 2;
}

.cntr .stand::after {
  content: "";
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translate(-50%);
  height: 10px;
  width: 50px;
  border-radius: 20px;
  background-color: #fdf9de;
  box-shadow: 0 10px 0 #fdf9de, 0 20px 0 #fdf9de, 0 30px 0 #fdf9de, 0 40px 0 #fdf9de,
              0 50px 0 #fdf9de, 0 60px 0 #fdf9de, 0 70px 0 #fdf9de, 0 80px 0 #fdf9de,
              0 90px 0 #fdf9de, 0 100px 0 #fdf9de, 0 110px 0 #fdf9de, 0 120px 0 #fdf9de,
              0 130px 0 #fdf9de, 0 140px 0 #fdf9de, 0 150px 0 #fdf9de, 0 160px 0 #fdf9de,
              0 170px 0 #fdf9de;
}

.cat {
  width: 110px;
  height: 50px;
  position: absolute;
  top: calc(50% - 50px);
  right: 130px;
  border-top-left-radius: 100px;
  border-top-right-radius: 100px;
}

.cat .body {
  width: 110px;
  height: 50px;
  background-color: #745260;
  position: absolute;
  border-top-left-radius: 100px;
  border-top-right-radius: 100px;
  animation: body 12s none infinite;
}

.cat .head {
  width: 70px;
  height: 35px;
  background-color: #745260;
  position: absolute;
  top: calc(50% - 10px);
  left: -40px;
  border-top-left-radius: 80px;
  border-top-right-radius: 80px;
}

.ear {
  position: absolute;
  left: 4px;
  top: -4px;
  width: 0;
  height: 0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-bottom: 20px solid #745260;
  transform: rotate(-30deg);
  animation: left-ear 12s both infinite;
}

.ear + .ear {
  animation: right-ear 12s both infinite;
  top: -12px;
  left: 30px;
}

.nose {
  position: absolute;
  bottom: 10px;
  left: -10px;
  background-color: #fd6e72;
  height: 5px;
  width: 5px;
  border-radius: 50%;
}

.whisker-container {
  position: absolute;
  bottom: 5px;
  left: -36px;
  width: 20px;
  height: 10px;
  transform-origin: right;
  animation: left-whisker 12s both infinite;
}

.whisker-container:nth-child(2) {
  left: -20px;
  bottom: 12px;
  transform-origin: right;
  transform: rotate(180deg);
  animation: right-whisker 12s both infinite;
}

.whisker {
  position: absolute;
  top: 0;
  width: 100%;
  border: 1px solid #fdf9de;
  transform-origin: 100% 0;
  transform: rotate(10deg);
}

.whisker:last-child {
  top: 0;
  transform: rotate(-20deg);
}

.tail-container {
  position: absolute;
  right: 0;
  bottom: -13px;
  z-index: 3;
}

.tail {
  position: absolute;
  height: 30px;
  width: 14px;
  bottom: -10px;
  right: 0;
  border-bottom-right-radius: 5px;
  background: #745260;
  z-index: 0;
}

.tail > .tail {
  animation: tail 10s none infinite;
  height: 100%;
  width: 14px;
  transform-origin: left;
  border-bottom-left-radius: 20px 20px;
  border-bottom-right-radius: 20px 20px;
  border-top-right-radius: 40px;
}

@keyframes tail {
  6.6667% { transform: rotate(0); }
  10% { transform: rotate(10deg); }
  16.6667% { transform: rotate(-5deg); }
  20% { transform: rotate(30deg); }
  26.6667% { transform: rotate(-2deg); }
  46.6667% { transform: rotate(10deg); }
  53.3333% { transform: rotate(-5deg); }
  56.6667% { transform: rotate(10deg); }
}

@keyframes body {
  6.6667% { transform: scaleY(1); }
  10% { transform: scaleY(1.15); }
  16.6667% { transform: scaleY(1); }
  20% { transform: scaleY(1.25); }
  26.6667% { transform: scaleY(1); }
  46.6667% { transform: scaleY(1.15); }
  53.3333% { transform: scaleY(1); }
  56.6667% { transform: scaleY(1.15); }
}


@keyframes left-whisker {
  6.6667% { transform: rotate(0); }
  10% { transform: rotate(0deg); }
  16.6667% { transform: rotate(-5deg); }
  20% { transform: rotate(0deg); }
  26.6667% { transform: rotate(0deg); }
  46.6667% { transform: rotate(10deg); }
  53.3333% { transform: rotate(-5deg); }
  56.6667% { transform: rotate(10deg); }
}

@keyframes right-whisker {
  6.6667% { transform: rotate(180deg); }
  10% { transform: rotate(190deg); }
  16.6667% { transform: rotate(180deg); }
  20% { transform: rotate(175deg); }
  26.6667% { transform: rotate(190deg); }
  46.6667% { transform: rotate(180deg); }
  53.3333% { transform: rotate(185deg); }
  56.6667% { transform: rotate(175deg); }
}

@keyframes left-ear {
  0% { transform: rotate(-20deg); }
  6.6667% { transform: rotate(-6deg); }
  13.3333% { transform: rotate(-15deg); }
  26.6667% { transform: rotate(-15deg); }
  33.3333% { transform: rotate(-30deg); }
  40% { transform: rotate(-30deg); }
  46.6667% { transform: rotate(0deg); }
  53.3333% { transform: rotate(0deg); }
  60% { transform: rotate(-15deg); }
  80% { transform: rotate(-15deg); }
  93.3333% { transform: rotate(-6deg); }
  100% { transform: rotate(-6deg); }
}

@keyframes right-ear {
  0% { transform: rotateZ(-16deg); }
  6.6667% { transform: rotateZ(-16deg); }
  13.3333% { transform: rotateZ(-19deg); }
  26.6667% { transform: rotateZ(-19deg); }
  33.3333% { transform: rotateZ(-30deg); }
  36.6667% { transform: rotateZ(-19deg); }
  37.3333% { transform: rotateZ(-30deg); }
  38% { transform: rotateZ(-19deg); }
  40% { transform: rotateZ(-19deg); }
  40.6667% { transform: rotateZ(-30deg); }
  41.3333% { transform: rotateZ(-19deg); }
  46.6667% { transform: rotateZ(-9deg); }
  53.3333% { transform: rotateZ(-9deg); }
  60% { transform: rotateZ(-19deg); }
  60.6667% { transform: rotateZ(-30deg); }
  61.3333% { transform: rotateZ(-19deg); }
  62.6667% { transform: rotateZ(-19deg); }
  63.3333% { transform: rotateZ(-30deg); }
  64% { transform: rotateZ(-19deg); }
  80% { transform: rotateZ(-19deg); }
  93.3333% { transform: rotateZ(-16deg); }
  100% { transform: rotateZ(-16deg); }
}
   

    /* Bayangan lantai */
    .floor{fill:url(#gFloor); opacity:.7; transform-origin:center; animation:floor-breathe 3s ease-in-out infinite}
    @keyframes floor-breathe{0%,100%{transform:scaleX(1)}50%{transform:scaleX(1.03)}}

    /* Tombol */
    .btn{appearance:none; border:0; background:linear-gradient(90deg, var(--pink), var(--pink-dark)); color:#fff; padding:.9rem 1.2rem; border-radius:999px; cursor:pointer; box-shadow:0 10px 28px rgba(226,85,134,.35); font-weight:600}
    .btn:hover{transform:translateY(-1px)}
    .tile-active {
  outline: 2px solid #ff4081;
}
.tile-hover {
  outline: 2px dashed #ff9800;
}
.tile-correct {
  box-shadow: 0 0 10px 4px rgba(0, 255, 0, 0.6);
  border: 2px solid limegreen;
  transition: box-shadow 0.3s ease, border 0.3s ease;
}


  .image-popup {
  position: absolute; /* tetap fixed biar overlay full layar */
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(8px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.35s ease;
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.image-popup.active {
  opacity: 1;
  pointer-events: auto;
}

.image-popup img {
  position: absolute; /* jangan fixed, biar ikut posisi flex container */
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  max-width: 90vw;   /* batas lebar maksimum 90% layar */
  max-height: 90vh;  /* batas tinggi maksimum 90% layar */
  width: auto;       /* supaya rasio tetap */
  height: auto;
  transition: all 0.4s ease;
}

    /* Scroll indicator */
    .scroll-tip{position:absolute; bottom:22px; left:50%; transform:translateX(-50%); color:#cdd8ff; opacity:.9; display:grid; justify-items:center; gap:.35rem}
    .mouse{width:24px; height:36px; border:2px solid #cdd8ff; border-radius:16px; position:relative}
    .mouse::after{content:""; width:4px; height:6px; background:#cdd8ff; border-radius:3px; position:absolute; top:6px; left:50%; transform:translateX(-50%); animation:s 1.4s infinite}
    @keyframes s{0%{opacity:.8; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,10px)}}

    /* ---------- Sections (asli milikmu, dipertahankan) ---------- */
    .sleep .belly, .sleep .tail, .awake .tail, .head, .paw-knead-left, .paw-knead-right{
     will-change: transform, opacity;}
    section{padding:72px 0; position:relative}
    .intro{background:var(--cream)}
    .intro .card{background:#fff; border-radius:22px; padding:clamp(18px, 3vw, 28px); box-shadow:0 14px 40px rgba(0,0,0,.08)}
    .quiz{background:linear-gradient(#fff, #fff6f9)}
    .quiz .q-card{background:#fff; border-radius:22px; padding:24px; box-shadow:0 14px 40px rgba(226,85,134,.12)}
    .quiz .opts{display:grid; gap:12px; margin-top:16px}
    .quiz .opt{border:2px solid #ffd1e3; background:#fff; color:#4a2a38; padding:.9rem 1rem; border-radius:14px; cursor:pointer; font-weight:600; transition:transform .12s, border-color .2s}
    .quiz .opt:hover{transform:translateY(-1px)}
    .quiz .opt.correct{border-color:var(--green); box-shadow:0 8px 18px rgba(46,204,113,.18)}
    .quiz .opt.wrong{border-color:var(--red); animation:shake .35s}
    @keyframes shake{10%,90%{transform:translateX(-2px)} 20%,80%{transform:translateX(4px)} 30%,50%,70%{transform:translateX(-6px)} 40%,60%{transform:translateX(6px)}}
    .gallery{background:#fff}
    .swiper{width:100%; height:520px}
    .swiper-slide{display:flex; align-items:center; justify-content:center}
    .slide-card{width:100%; height:100%; border-radius:20px; overflow:hidden; box-shadow:0 16px 40px rgba(226,85,134,.18)}
    .slide-card img, .slide-card video{width:100%; height:100%; object-fit:cover}
    .swiper-pagination-bullet{background:var(--pink-dark) !important; opacity:.35}
    .swiper-pagination-bullet-active{opacity:1}
    .swiper-button-prev, .swiper-button-next{color:var(--pink-dark)}
    .story{max-width:900px; margin:18px auto 0; text-align:center; opacity:0; transform:translateY(8px); transition:all .35s}
    .story.show{opacity:1; transform:none }
    .lightbox{position:absolute; inset:0; background:rgba(0,0,0,.84); display:none; align-items:center; justify-content:center; z-index:60}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw; max-height:86vh; border-radius:18px; box-shadow:0 24px 60px rgba(0,0,0,.5); transform:scale(.96); transition:transform .25s}
    .lightbox.open img{transform:scale(1)}
    .timeline{background:linear-gradient(#fff, #fff2f6)}
    .tl{position:relative; margin:0; padding:0; list-style:none}
    .tl::before{content:""; position:absolute; left:50%; top:0; bottom:0; width:4px; background:linear-gradient(var(--gold), #ffe2b8); border-radius:3px; transform:translateX(-50%)}
    .tl li{position:relative; width:50%; padding:26px 28px}
    .tl li:nth-child(odd){left:0; text-align:right}
    .tl li:nth-child(even){left:50%}
    .tl .dot{position:absolute; top:32px; left:calc(50% - 10px); width:20px; height:20px; background:var(--pink); border:3px solid #fff; border-radius:50%; box-shadow:0 8px 18px rgba(226,85,134,.45)}
    .tl article{background:#fff; border-radius:18px; box-shadow:0 12px 30px rgba(0,0,0,.08); padding:18px 20px; opacity:0; transform:translateY(16px); transition:all .6s}
    .tl li.reveal article{opacity:1; transform:none}
    .tl h4{margin:.2rem 0 .35rem; font-family:'Cormorant Garamond', serif; font-size:1.4rem}
    .tl time{font-size:.85rem; opacity:.7}
    @media (max-width:820px){
      .tl::before{left:20px; transform:none}
      .tl li{width:100%; padding-left:56px; text-align:left}
      .tl li:nth-child(even){left:0}
      .tl .dot{left:12px}
    }

    .puzzle{background:linear-gradient(#fff, #fff7fb)}
    .pzl-wrap{display:grid; gap:18px; align-items:center; justify-items:center}
    .board{position:relative; width:min(560px, 92vw); height:min(560px, 92vw); display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:6px; background:#ffd3e3; padding:6px; border-radius:18px; box-shadow:0 16px 40px rgba(226,85,134,.16)}
    .tile{position:relative; background:#fff; border-radius:12px; overflow:hidden; cursor:grab; user-select:none; box-shadow:inset 0 0 0 2px #ffffffaa}
    .tile:active{cursor:grabbing}
    .pzl-toolbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}

    .finale{position:relative; background:radial-gradient(circle at 20% 20%, #fff2f6, #ffe3ef 40%, #ffd1e3 70%)}
    .finale-card{background:#fff; border-radius:24px; padding:30px; text-align:center; box-shadow:0 16px 50px rgba(226,85,134,.18)}
    .hearts{position:absolute; inset:0; overflow:hidden; pointer-events:none}
    .heart{position:absolute; width:14px; height:14px; background:var(--rose); transform:rotate(45deg); animation:float 10s linear infinite; opacity:.6}
    .heart::before,.heart::after{content:""; position:absolute; width:14px; height:14px; background:var(--rose); border-radius:50%}
    .heart::before{left:-7px}
    .heart::after{top:-7px}
    @keyframes float{0%{transform:translateY(100%) rotate(45deg)}100%{transform:translateY(-120%) rotate(45deg)}}

    .sec-head{display:flex; align-items:center; gap:12px; margin-bottom:18px}
    .sec-head .bar{width:26px; height:6px; background:linear-gradient(90deg, var(--gold), #ffe8c9); border-radius:6px}
    .title{font-family:'Cormorant Garamond', serif; font-weight:700; letter-spacing:.5px}
    .muted{opacity:.75}

    .music-toggle{position:fixed; right:16px; bottom:16px; z-index:70; background:#ffffffde; color:#4a2a38; border:1px solid #00000012; padding:10px 14px; border-radius:999px; box-shadow:0 10px 28px rgba(0,0,0,.12)}
    .settings-btn{position:fixed; right:16px; bottom:66px; z-index:70; background:#ffffffde; border:1px solid #00000012; padding:10px 14px; border-radius:999px; box-shadow:0 10px 28px rgba(0,0,0,.12); cursor:pointer}
    .settings-panel{position:fixed; right:16px; bottom:118px; z-index:72; width:260px; background:#fff; border:1px solid #00000012; border-radius:16px; box-shadow:0 20px 50px rgba(0,0,0,.12); padding:12px 14px; display:none}
    .settings-panel.open{display:block}
    .settings-panel .sp-head{font-weight:600; margin-bottom:6px}
    .settings-panel .sp-row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:8px 0}
    .settings-panel input[type=range]{width:140px}
    @media (prefers-reduced-motion: reduce){
      *, *::before, *::after{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
    }
   
  </style>
</head>
<body>
  <!-- Sounds -->
  <audio id="bgm" preload="auto" src="assets/bgm.mp3"></audio>
  <audio id="chime" preload="auto" src="assets/chime.mp3"></audio>

  <!-- HERO / OPENING -->
  <header class="hero" id="hero">
    <div class="hero-inner">
      <div class="headline">
        <div class="title"><span id="typewriter" class="typewriter"></span> </div>
        <div class="tag">Touch or scroll gently, don't wake him.</div>
        
      </div>

     <div class="cntr">
  <span class="stand"></span>
  <div class="cat">
    <div class="body"></div>
    <div class="head">
      <div class="ear"></div>
      <div class="ear"></div>
    </div>
    <div class="face">
      <div class="nose"></div>
      <div class="whisker-container">
        <div class="whisker"></div>
        <div class="whisker"></div>
      </div>
      <div class="whisker-container">
        <div class="whisker"></div>
        <div class="whisker"></div>
      </div>
    </div>
    <div class="tail-container">
      <div class="tail">
        <div class="tail">
          <div class="tail">
            <div class="tail">
              <div class="tail">
                <div class="tail">
                  <div class="tail"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<br>
    <div class="scroll-tip" aria-hidden="true">
      
      <small>(Sssst,Darwin sleepingüêæ)</small>
    </div>
  </header>

  <!-- INTRO NOTE -->
  <section class="intro" id="intro">
    <div class="container" style="width:min(1100px,92%); margin-inline:auto">
      <div class="card">
        <div class="sec-head"><span class="bar"></span><h2 class="title" style="margin:0">For Us</h2></div>
        <p class="muted">Terima kasih telah menjadi rumah paling hangat. Di bawah ini ada galeri kenangan, quiz seru, puzzle rahasia, dan timeline momen penting kita. Semoga halaman ini selalu mengingatkan bahwa cinta kita tumbuh setiap hari. üíû</p>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section class="quiz" id="quiz">
    <div class="container" style="width:min(900px,92%); margin-inline:auto">
      <div class="sec-head"><span class="bar"></span><h2 class="title" style="margin:0">Mini Quiz</h2></div>
      <div class="q-card">
        <p style="margin:0; font-weight:600">When did we first meet? (If you answer incorrectly, the next page will be locked.)</p>
        <div class="opts">
          <button class="opt" data-correct="false">14 August 2024</button>
          <button class="opt" data-correct="true">13 August 2024</button>
          <button class="opt" data-correct="false">16 August 2024</button>
        </div>
        <p id="qMsg" class="muted" style="margin-top:10px"></p>
      </div>
    </div>
  </section>

  <!-- GALLERY (Swiper) + STORY MODE -->
  <section class="gallery" id="gallery">
    <div class="container" style="width:min(1100px,92%); margin-inline:auto">
      <div class="sec-head"><span class="bar"></span><h2 class="title" style="margin:0">Our Memory</h2></div>

      <div class="swiper" id="mainSwiper">
        <div class="swiper-wrapper">
          <!-- Ganti src dengan file kalian -->
          <div class="swiper-slide"><figure class="slide-card" data-caption="Pertama kali kita jalan bareng di kafe favorit."><img src="assets/photo1.jpg" alt="Momen 1" loading="lazy"></figure></div>
          <div class="swiper-slide"><figure class="slide-card" data-caption="Foto candid waktu hujan, tapi senyummu tetap hangat."><video src="assets/video1.mp4" muted loop playsinline></video></figure></div>
          <div class="swiper-slide"><figure class="slide-card" data-caption="Sunset yang kita saksikan berdua ‚Äî tenang banget."><img src="assets/photo2.jpg" alt="Momen 3" loading="lazy"></figure></div>
          <div class="swiper-slide"><figure class="slide-card" data-caption="Video singkat perjalanan pertama kita."><video src="assets/video2.mp4" muted loop playsinline></video></figure></div>
          <div class="swiper-slide"><figure class="slide-card" data-caption="Momen spesial yang bikin aku jatuh cinta lagi."><img src="assets/photo3.jpg" alt="Momen 4" loading="lazy"></figure></div>
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev" aria-label="Sebelumnya"></div>
        <div class="swiper-button-next" aria-label="Berikutnya"></div>
      </div>

      <div id="story" class="story muted">Click on the photo to enlarge it. The photo story will appear here.</div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Tampilan penuh gambar">
      <img id="lightboxImg" alt="Foto kenangan" />
    </div>
  </section>

  <!-- PUZZLE -->
  <section class="puzzle" id="puzzle">
    <div class="container" style="width:min(1000px,92%); margin-inline:auto">
      <div class="sec-head"><span class="bar"></span><h2 class="title" style="margin:0">Secret Puzzle</h2></div>
      <div class="pzl-wrap">
        <p class="muted" style="text-align:center">Arrange these pieces to reveal a special message. üíó</p>
        <div class="board" id="board" aria-label="Papan puzzle" data-img="assets/puzzle.jpg"></div>
        <div class="pzl-toolbar">
          <button class="btn" id="shuffleBtn">üîÄ Shuffle</button>
        </div>
        <div id="pzlMsg" class="muted" style="text-align:center"></div>
      </div>
    </div>
  </section>

  <!-- TIMELINE -->
  <section class="timeline" id="timeline">
    <div class="container" style="width:min(1100px,92%); margin-inline:auto">
      <div class="sec-head"><span class="bar"></span><h2 class="title" style="margin:0">The timeline of our love</h2></div>
      <ul class="tl" id="tl">
        <li ><span class="dot"></span><article><time>13 AUGUST 2024</time><h4>First meeting</h4><p>We met at Grandma's, and at that time we followed each other's movements,I still remember the clothes you wore. you looked like a soft cloud....</p></article></li>
        <li data-img="assets/FS.jpg" ><span class="dot"></span><article><time>14 AUGUST 2024</time><h4>Love at First Sight</h4><p>After that, we always played together. When I first met you, I felt that I was compatible with your attitude and way of thinking. I like that part of you</p></article></li>
        <li><span class="dot"></span><article><time>16 AUGUST 2024</time><h4>A promise</h4><p>I decided to express my feelings to you. I told you that I loved you and wanted to grow old with you üíï</p></article></li>
        <li data-img="assets/JY.png"><span class="dot"></span><article><time>2024-2025</time><h4>Our Journey</h4><p>We have been together until now, sharing each other's happiness and sadness, the pain of separation and the joy of love itself. We have been through many things with interesting stories.</p></article></li>
        <li data-img="assets/AN.jpg"><span class="dot"></span><article><time>2025</time><h4>Special Anniversary</h4><p>This page is for you ‚Äî a digital hug that never tires, I will always be there for you even though we are far apart... Te amo con todo mi corazonüíñ</p></article></li>
      </ul>
      <div class="image-popup" id="imagePopup">
  <img src="" alt="">
</div>

    </div>
  </section>

  <!-- SETTINGS -->
  <button class="settings-btn" id="settingsBtn" aria-label="Pengaturan tampilan">‚öôÔ∏è</button>
  <div class="settings-panel" id="settingsPanel" role="dialog" aria-modal="false" aria-label="Pengaturan">
    <div class="sp-head"><strong>Display Settings</strong></div>
    <label class="sp-row">Contrast
      <input type="range" id="softness" min="70" max="110" value="95">
    </label>
    <label class="sp-row">Background Brightness
      <input type="range" id="brightness" min="90" max="110" value="100">
    </label>
    <p class="muted" style="margin-top:6px">Tip: swipe left for a softer pink, right for a slightly bolder shade.</p>
  </div>

  <!-- FINALE -->
  <section class="finale" id="finale">
    <div class="hearts" aria-hidden="true"></div>
    <div class="container" style="width:min(1000px,92%); margin-inline:auto">
      <div class="finale-card">
        <h2 class="title" style="margin-top:0">Forever With You</h2>
        <p class="muted">If you ever have doubts, open this page ‚Äî remember, every day I fall in love with you again and again.</p>
        <div style="margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap">
          <button class="btn" id="replayOpen">üîÅ See Darwin Again</button>
          <button class="btn" id="toggleMusic">üîä Music</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Floating control -->
  <button class="music-toggle" id="musicFloating">üîä Start/Pause Music</button>

  <!-- Scripts -->
  <script src="https://unpkg.com/swiper@9/swiper-bundle.min.js"></script>
<script>
  
  // ---------- Typewriter ----------
  const twEl = document.getElementById('typewriter');
  const TW_TEXT = 'Happy Anniversary Amor!!';
  let twIdx = 0;
   const bgm = document.getElementById('bgm');
    if (bgm) bgm.loop = true;
    let musicStarted = false;
    function startMusicOnce(){
    if (musicStarted || !bgm) return;
    bgm.play().then(()=>{ musicStarted = true; })
      .catch(()=>{ /* kalau ditolak browser, biarkan tombol manual */ });
  }
  
  (function typeLoop(){
      if (twIdx === Math.floor(TW_TEXT.length / 2)) startMusicOnce();
    if(twIdx <= TW_TEXT.length){
      twEl.textContent = TW_TEXT.slice(0, twIdx++);
      setTimeout(typeLoop, 70);
      
    } else {
      twEl.style.borderRight = '0';
    }
  })();

  // ---------- Elemen yang dipakai ----------
  const hero = document.getElementById('hero');
  const replayOpen = document.getElementById('replayOpen');
  const chime = document.getElementById('chime');
  const musicBtn = document.getElementById('toggleMusic');
  const musicFloating = document.getElementById('musicFloating');


  document.addEventListener('DOMContentLoaded', () => {
  const tl = document.getElementById('tl');
  const popup = document.getElementById('imagePopup');
  const popupImg = popup.querySelector('img');

  let startRect = null; // posisi awal

  tl.addEventListener('click', (e) => {
    const li = e.target.closest('li');
    if (!li || !li.dataset.img) return;

    // ambil posisi li di layar
    const rect = li.getBoundingClientRect();
    startRect = rect;

    // set gambar & posisi awal
    popupImg.src = li.dataset.img;
    popupImg.style.top = rect.top + 'px';
    popupImg.style.left = rect.left + 'px';
    popupImg.style.width = rect.width + 'px';
    popupImg.style.height = rect.height + 'px';

    // tampilkan overlay
    popup.classList.add('active');

    popup.scrollIntoView({ behavior: 'smooth', block: 'center' });
 

    // animasi ke fullscreen
    requestAnimationFrame(() => {
      popupImg.style.top = '50%';
      popupImg.style.left = '50%';
      popupImg.style.width = '80vw';
      popupImg.style.height = '80vh';
      popupImg.style.transform = 'translate(-50%, -50%)';
    });
  });

  popup.addEventListener('click', () => {
    if (!startRect) return;
    // animasi kembali ke posisi awal
    popupImg.style.top = startRect.top + 'px';
    popupImg.style.left = startRect.left + 'px';
    popupImg.style.width = startRect.width + 'px';
    popupImg.style.height = startRect.height + 'px';
    popupImg.style.transform = 'none';

    // tunggu animasi selesai lalu tutup overlay
    setTimeout(() => {
      popup.classList.remove('active');
    }, 400);
  });
});
  // Pastikan loop


  // ---------- Autoplay musik saat interaksi pertama ----------

  
  // Anggap interaksi: scroll, klik/ketuk, sentuh, keyboard
  window.addEventListener('scroll', startMusicOnce, { once:true, passive:true });
  window.addEventListener('pointerdown', startMusicOnce, { once:true });
  window.addEventListener('touchstart', startMusicOnce, { once:true, passive:true });
  window.addEventListener('keydown', startMusicOnce, { once:true });

  // ---------- Tombol Musik ----------
  function toggleMusic(){
    if (!bgm) return;
    if (bgm.paused){ bgm.play().catch(()=>{}); }
    else { bgm.pause(); }
  }
  musicBtn?.addEventListener('click', toggleMusic);
  musicFloating?.addEventListener('click', toggleMusic);

  // ---------- Replay: scroll ke atas ----------
  replayOpen?.addEventListener('click', ()=>{
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // ---------- Settings sliders ----------
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsPanel = document.getElementById('settingsPanel');
  const softness = document.getElementById('softness');
  const brightness = document.getElementById('brightness');
  settingsBtn?.addEventListener('click', ()=> settingsPanel.classList.toggle('open'));
  function applyTuning(){
    const sat = (parseInt(softness?.value ?? '95',10)||95)/100;
    const bri = (parseInt(brightness?.value ?? '100',10)||100)/100;
    document.documentElement.style.setProperty('--sat', sat);
    document.documentElement.style.setProperty('--bri', bri);
  }
  softness?.addEventListener('input', applyTuning);
  brightness?.addEventListener('input', applyTuning);
  applyTuning();

  // ---------- Quiz Logic ----------
  // Fungsi Lock & Unlock Scroll
let scrollPosition = 0;
function lockScroll() {
  scrollPosition = window.scrollY;
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollPosition}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';
  document.body.style.overflow = 'hidden';
}
function unlockScroll() {
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.left = '';
  document.body.style.right = '';
  document.body.style.overflow = '';
  window.scrollTo(0, scrollPosition);
}

// Quiz logic
// === 1) Utility: Lock & Unlock Scroll (tambahkan di global) ===
let scrollLocked = false;

function lockScroll() {
  if (scrollLocked) return;
  scrollPosition = window.scrollY;
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollPosition}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';
  document.body.style.overflow = 'hidden';
  scrollLocked = true;
}

function unlockScroll() {
  if (!scrollLocked) return;
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.left = '';
  document.body.style.right = '';
  document.body.style.overflow = '';
  window.scrollTo(0, scrollPosition);
  scrollLocked = false;
}

// === 2) Kode quiz kamu (TAMBAHKAN unlockScroll() saat benar) ===
const opts = document.querySelectorAll('.quiz .opt');
const qMsg = document.getElementById('qMsg');
let quizPassed = false;

opts.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    if(quizPassed) return;
    const isCorrect = btn.dataset.correct === 'true';

    if(isCorrect){
      btn.classList.add('correct');
      qMsg.textContent = 'Yeay! Lets go to the next pageüíï';
      chime?.play?.();
      quizPassed = true;

      // ‚¨áÔ∏è Buka scroll setelah jawabannya benar
      unlockScroll();

      setTimeout(()=> document.getElementById('gallery')
        .scrollIntoView({behavior:'smooth'}), 900);

    }else{
      btn.classList.add('wrong');
      qMsg.textContent = 'TU NO ME AMAS!! üòí';
      setTimeout(()=> btn.classList.remove('wrong'), 400);
      // Tidak perlu lock di sini, karena sudah terkunci sejak masuk quiz
    }
  })
})

// === 3) Kunci scroll otomatis saat memasuki section quiz ===
// Pastikan ID section quiz kamu adalah #quiz
document.addEventListener('DOMContentLoaded', () => {
  const quizSection = document.getElementById('quiz');
  if (!quizSection) return;

  // Bila user menggulir hingga quiz terlihat (‚â•50%), snap ke atas quiz lalu kunci
  const io = new IntersectionObserver((entries) => {
    const e = entries[0];
    if (e.isIntersecting && !quizPassed && !scrollLocked) {
      // Snap ke awal section quiz
      const targetY = Math.round(window.scrollY + quizSection.getBoundingClientRect().top);
      window.scrollTo({ top: targetY, behavior: 'smooth' });

      // Kunci sedikit setelah posisi stabil
      setTimeout(() => { 
        if (!quizPassed) lockScroll();
      }, 250);
    }
  }, { threshold: 0.5 });

  io.observe(quizSection);
});



  // ---------- Swiper (Gallery) + Story ----------
  const swiper = new Swiper('#mainSwiper', {
    loop: true,
    centeredSlides: true,
    speed: 700,
    autoplay: { delay: 2800, disableOnInteraction: false },
    effect: 'coverflow',
    coverflowEffect: { rotate: 24, stretch: 0, depth: 140, modifier: 1, slideShadows: false },
    slidesPerView: 1,
    breakpoints: { 720: { slidesPerView: 1.05 }, 1024: { slidesPerView: 1.15 } },
    pagination: { el: '.swiper-pagination', clickable: true },
    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
  });

  const story = document.getElementById('story');
  function updateStory(){
    const slide = swiper.slides[swiper.activeIndex];
    const cap = slide?.querySelector('.slide-card')?.dataset?.caption || '';
    if(cap){ story.textContent = cap; story.classList.add('show'); }
  }
  swiper.on('slideChange', updateStory);
  setTimeout(updateStory, 600);

  // Pause autoplay saat galeri tak terlihat
  const gallerySection = document.getElementById('gallery');
  const galleryObs = new IntersectionObserver(entries=>{
    entries.forEach(e=>{ if(e.isIntersecting){ swiper.autoplay.start(); } else { swiper.autoplay.stop(); } })
  }, {threshold:.2});
  galleryObs.observe(gallerySection);

  // Lightbox
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightboxImg');
  document.getElementById('mainSwiper').addEventListener('click', (e)=>{
    const img = e.target.closest('img'); if(!img) return; lightboxImg.src = img.src; lightbox.classList.add('open');
  });
  lightbox.addEventListener('click', ()=> lightbox.classList.remove('open'));

  // ---------- Timeline reveal ----------
  const tlItems = document.querySelectorAll('.tl li');
  const tlObs = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('reveal'); } });
  }, { threshold: .25 });
  tlItems.forEach(i=> tlObs.observe(i));

  // ---------- Puzzle (Drag & Drop) ----------
const board = document.getElementById('board');
const pzlMsg = document.getElementById('pzlMsg');
const shuffleBtn = document.getElementById('shuffleBtn');
const revealBtn = document.getElementById('revealBtn');

const SIZE = 3;
let tiles = [];

function buildBoard(){
  board.innerHTML = '';
  tiles = [];
  const img = board.dataset.img;
  const w = board.clientWidth;
  const h = board.clientHeight;
  const pw = w / SIZE;
  const ph = h / SIZE;

  for(let r=0; r<SIZE; r++){
    for(let c=0; c<SIZE; c++){
      const i = r*SIZE + c;
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.draggable = true;
      tile.dataset.correct = i;
      tile.dataset.current = i;
      tile.style.backgroundImage = `url('${img}')`;
      tile.style.backgroundSize = `${w}px ${h}px`;
      tile.style.backgroundPosition = `-${c*pw}px -${r*ph}px`;
      board.appendChild(tile);
      tiles.push(tile);
    }
  }
  attachDnD();
}

function shuffleTiles(){
  const order = [...Array(SIZE*SIZE).keys()];
  for(let i=order.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [order[i], order[j]] = [order[j], order[i]];
  }
  order.forEach((origIndex, pos)=>{
    const t = tiles[origIndex];
    t.dataset.current = pos;
    board.appendChild(t);
  });
  pzlMsg.textContent = 'Drag or tap the tiles to arrange the image.';

  // üîí Lock scroll (puzzle belum selesai)

  // Hapus highlight sebelumnya
  tiles.forEach(tile => tile.classList.remove('tile-correct'));
}

function isSolved(){
  return tiles.every(t => t.dataset.current === t.dataset.correct);
}

// Gabungan drag-and-drop & touch
function attachDnD(){
  let src = null;

  tiles.forEach(t=>{
    // --- Drag & Drop (desktop) ---
    t.addEventListener('dragstart', e=>{
      src = t;
      e.dataTransfer.setData('text/plain', t.dataset.current);
    });
    t.addEventListener('dragover', e=> e.preventDefault());
    t.addEventListener('drop', e=>{
      e.preventDefault();
      if(!src || src===t) return;
      swapTiles(src, t);
    });

    // --- Sentuhan (mobile) ---
    t.addEventListener('touchstart', e=>{
      src = t;
      t.classList.add('tile-active');
      e.preventDefault();
    }, { passive: false });

    t.addEventListener('touchmove', e=>{
      e.preventDefault();
      const touch = e.touches[0];
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      tiles.forEach(tile => tile.classList.remove('tile-hover'));
      if(target && target.classList.contains('tile') && target !== src){
        target.classList.add('tile-hover');
      }
    }, { passive: false });

    t.addEventListener('touchend', e=>{
      e.preventDefault();
      const touch = e.changedTouches[0];
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      tiles.forEach(tile => tile.classList.remove('tile-active', 'tile-hover'));

      if(target && target.classList.contains('tile') && target !== src){
        swapTiles(src, target);
      }
      src = null;
    }, { passive: false });
  });
}

// Fungsi tukar ubin (dipakai untuk mouse & touch)
function swapTiles(aTile, bTile){
  const a = aTile.dataset.current;
  const b = bTile.dataset.current;

  const aNext = aTile.nextSibling;
  const bNext = bTile.nextSibling;
  const parent = aTile.parentNode;

  parent.insertBefore(aTile, bNext);
  parent.insertBefore(bTile, aNext);

  aTile.dataset.current = b;
  bTile.dataset.current = a;

  if(isSolved()) solvedAction();
}

function solvedAction(){
  // Highlight hijau semua ubin
  tiles.forEach(tile => tile.classList.add('tile-correct'));

  // üîì Unlock scroll (puzzle selesai)
    unlockScroll();

  pzlMsg.innerHTML = 'üéâ You have completed the puzzle! Special Message : <b>Tu eres hong üíï</b>';
  chime?.play?.();
}

function revealSolution(){
  tiles.sort((a,b)=> a.dataset.correct - b.dataset.correct).forEach(t=>{
    board.appendChild(t);
    t.dataset.current = t.dataset.correct;
  });
  solvedAction();
}

window.addEventListener('load', ()=>{ buildBoard(); shuffleTiles(); });
window.addEventListener('resize', ()=>{ buildBoard(); shuffleTiles(); });
shuffleBtn?.addEventListener('click', shuffleTiles);
revealBtn?.addEventListener('click', revealSolution);


   window.history.scrollRestoration = "manual";
window.scrollTo(0, 0);
  
</script>

</body>
</html>
